<div class="row justify-content-center align-items-center mt-4" *ngIf="isAdmin == true; else errorBlock">
  <h1>Nature des Missions</h1>

  <table id="missions" class="table table-striped table-bordered mt-3" cellspacing="0" width="100%">
    <thead class="thead-dark">
      <tr>
        <th class="th-sm">Nature</th>
        <th class="th-sm">Facturée</th>
        <th class="th-sm">Prime</th>
        <th class="th-sm">TJM (€)</th>
        <th class="th-sm">%Prime</th>
        <th class="th-sm">Plafond frais</th>
        <th class="th-sm">Dépt. frais</th>
        <th class="th-sm">Actions</th>
      </tr>
    </thead>

    <tbody *ngFor="let NatureMission of natureMissions">
      <tr>
        <td>{{NatureMission.code}}</td>
        <td>{{NatureMission.isFacturee}}</td>
        <td>{{NatureMission.hasPrime}}</td>
        <td>{{NatureMission.tjm}}</td>
        <td>{{NatureMission.pourcentagePrime}}</td>
        <td>{{NatureMission.plafondFrais}}</td>
        <td>{{NatureMission.depassPlafond}}</td>
        <td><a href=""><img class="mr-3" src="../../assets/img/edition.png" width="20"  alt="edit"></a>
          <a><img src="../../assets/img/delete.png" width="20" alt="delete" (click)="openModal(template, NatureMission.id)"></a></td>
      </tr>
    </tbody>
  </table>
  Ajouter une nature de mission <button type="button" class="btn btn-primary" (click)="openCreateModal(creation)">
      +
    </button>
  </div>

    <ng-template #creation>
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Ajout d'une nature de mission</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-row">
            <div class="form-group col-md-6">
                <label for="natCode">Nature</label>
            </div>
            <div class="form-group col-md-6">
                <input type="text" id="natCode" class="form-control" [(ngModel)]="natMission.code" required #natCode="ngModel">
            <div *ngIf="(natCode.dirty || natCode.touched) && natCode.invalid">
                Code invalide!
            </div>
          </div>
            
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
                <label for="isFacturee">Facturée</label>
            </div>
                <div class="form-group col-md-6">
                <select class="custom-select" name="natureFacturee" id="isFacturee" [(ngModel)]="natMission.isFacturee"
                required #isFacturee="ngModel">
                <option value="OUI">Oui</option>
                <option value="NON">Non</option>
              </select>
              <div *ngIf="(isFacturee.dirty || isFacturee.touched) && isFacturee.invalid">
                Champ obligatoire!
            </div>
            </div>
            
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
                <label for="natPrime">Versement prime</label>
            </div>
            <div class="form-group col-md-6">
                 <input type="number" id="natPrime" class="form-control" name="naturePrime" [(ngModel)]="natMission.hasPrime" required #natPrime="ngModel">
            <div *ngIf="(natPrime.dirty || natPrime.touched) && natPrime.invalid">
                Veuillez saisir un montant!
            </div>
          </div>
            
          </div>
          <div class="form-row">  
            <div class="form-group col-md-6">
                <label for="natTJM">TJM (€)</label>
            </div>
            <div class="form-group col-md-6">
                <input type="number" id="natTJM" class="form-control" name="natureTJM" [(ngModel)]="natMission.tjm" required #natTJM="ngModel">
            <div *ngIf="(natTJM.dirty || natTJM.touched) && natTJM.invalid">
                Veuillez saisir un montant!
            </div>
          </div>
            
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
                <label for="nat%Prime">%Prime</label>
            </div>
            <div class="form-group col-md-6">
                <input type="number" max='10' id="%Prime" class="form-control" name="nature%Prime" [(ngModel)]="natMission.pourcentagePrime" required #natPrcPrime="ngModel">
            <div *ngIf="(natPrcPrime.dirty || natPrcPrime.touched) && natPrcPrime.invalid">
                Veuillez saisir une valeur!
            </div>
          </div>
            
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
                <label for="natPlafond">Plafond frais</label>
            </div>
            <div class="form-group col-md-6">
                <input type="text" id="natPlafond" class="form-control" name="naturePlafond" [(ngModel)]="natMission.plafondFrais" required #natPfd="ngModel">
            <div *ngIf="(natPfd.dirty || natPfd.touched) && natPfd.invalid">
                Veuillez saisir un montant!
            </div>
          </div>
            
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
                <label for="depassPlafond">Dépt. frais</label>
            </div>
            <div class="form-group col-md-6">
                <select class="custom-select" name="natureDept" id="depassPlafond" [(ngModel)]="natMission.depassPlafond"
                required #depassPlafond="ngModel">
                <option value="OUI">Oui</option>
                <option value="NON">Non</option>
              </select>
            <div *ngIf="(depassPlafond.dirty || depassPlafond.touched) && depassPlafond.invalid">
                Champ obligatoire!
            </div>
          </div>
            
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
                <label for="natDV">Début de validité</label>
            </div>
            <div class="form-group col-md-6">
                <input type="text" id="natDV" class="form-control" name="natureDebutValidite" [(ngModel)]="natMission.debutValidite">
            </div>    
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
                <label for="natFV">Fin de validité</label>
            </div>
            <div class="form-group col-md-6">
              <input type="text" id="natFV" class="form-control" name="natureFinValidite" [(ngModel)]="natMission.finValidite" required #natFV="ngModel">
            <div *ngIf="(natFV.dirty || natFV.touched) && natFV.invalid">
                Veuillez saisir une date!
            </div>
          </div>
            
          </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
            <button type="button" class="btn btn-primary">Valider</button>
          </div>
        </div>
    </ng-template>

<ng-template #template>
  <div class="modal-body text-center">
    <p>Confirmez-vous la suppression de la mission ?</p>
    <button type="button" class="btn btn-default" (click)="confirm()" >Yes</button>
    <button type="button" class="btn btn-primary" (click)="decline()">No</button>
  </div>
</ng-template>

<ng-template #errorBlock>
    <div class="row justify-content-center align-items-center">
      <p>Vous ne disposez pas des autorisations nécessaires pour accéder à cette page!</p>
    </div>
</ng-template>
